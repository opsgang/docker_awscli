# vim: et sr sw=2 ts=2 smartindent:
language: none

branches:
  only:
    - evaluate_shippable

build:
  
  ci:
    - docker --version
    - docker pull opsgang/awscli:stable
    - git clone https://github.com/opsgang/alpine_build_scripts --depth 1
    - ./build.sh
    - echo $(grep -Po '(?<=[vV]ersion=")[^"]+' Dockerfile | head -n 1)>.ov
    - echo $(cat .ov)_$(date +'%Y%m%d%H%m%s')>.nv
    - docker tag opsgang/awscli:$(cat .ov) opsgang/awscli:$(cat .nv)

  on_success:
    - echo "version tag is " $(cat .nv)
    - docker push opsgang/awscli:$(cat .nv)
