# vim: et sr sw=2 ts=2 smartindent:
language: none

branches:
  only:
    - evaluate_shippable

env:
  - secure: 3yF/Z8TLKOYeNjdHNqArN5mBrlSRPewBgkQ9ksgucMUgyiOUuWJQgPn7+szasLtA9fqOXhpi2i/CTS/7Tb8bGwmK+pXnciyJ8fmOxXN8UrqVft1eXrYwqxKLt1aU8BC+0MXvz59xJ78eNsgkjwW5ajdibr4yMU42iXsMD4NC8/7UaD31fUG3FqZOTYOPLIo+e3BuDExjjtmLgbB8RMIIewZTNB/z8tN8oIUSL3n8vpe2pdg1T66J3rhcol4gWLUOsZoWl+JrASXYqzci00RXEy4P7w073soZ3eM++Em4PyImxtRd0Xr68w9+b5tG6UPOWdEYujhF3HLAs2+2LrQg3A==

build:
  
  ci:
    - docker --version
    - docker pull opsgang/awscli:stable
    - git clone https://github.com/opsgang/alpine_build_scripts --depth 1
    - ./build.sh
    - echo $(grep -Po '(?<=[vV]ersion=")[^"]+' Dockerfile | head -n 1)>.ov
    - echo $(cat .ov)_$(date +'%Y%m%d%H%m%s')>.nv
    - docker tag opsgang/awscli:$(cat .ov) opsgang/awscli:$(cat .nv)

  on_success:
    - echo "version tag is " $(cat .nv)
    - docker login -p $DHP -u $DHU
    - docker push opsgang/awscli:$(cat .nv)
